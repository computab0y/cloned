# OpenShift Cluster Log Forwarding

This directory contains kustomize definitions for the installation of Cluster Log Forwarding (CLF) on OpenShift.

CLF is deployed using the standard `ClusterLogForwarder` Custom Resource.

Currently forwarding to Azure Monitor (part of Azure Analytics used within Sentinel) is supported. Other SIEM targets such as Splunk may be provided for in the future.

## Install the CLF for Axure Monitor Operator using the `oc` CLI
An overlay is provided to deploy a CLF that targets Azure Monitor

Azure Monitor utilises a different driver which is not included within the standard Fluentd collector container image provided by OpenShift Logging.

Azure Monitor requires credentials are provided to enable fluentbit to access Azure Monitor and forward logs to it. Each cluster utilises a different Azure Monitor instance, so the correct credentials need to be passed to enable a kubernetes secret with the correct credentials to be created.

This kustomize manifests requires two (2) environment variables be set.

`WORKSPACE_ID` - The Workspace within Azure Monitor that logs will be forwarded to
`SHARED_KEY` - The Shared Key generated by Azure Monitor that is required to access the Workspace

### Set the Environment Variables
```
$ export WORKSPACE_ID=xxxxxxxxxxxxxxx 
$ export SHARED_KEY=yyyyyyyyyyyyyy
```

### Deploy the manifests
```
$ oc create -k dayzero/legion/cohorts/openshift/06-logging/log-forwarding/azure-monitor/overlays/fluentbit-1.9
```

